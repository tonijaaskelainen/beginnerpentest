# Penetration Testing -harjoitusympäristön toteutus vapailla ohjelmilla
## Kali Linuxiin sisältyvällä Metasploitilla tunkeutuminen Metasploitable 2 -koneeseen Vagrant-virtuaaliympäristössä

Toni Jääskeläinen

Opinnäytetyö  
Tietojenkäsittelyn koulutusohjelma  
13.9.2016

# Johdanto

Täydennetään myöhemmin lisää...

## Projektin tausta

Projekti käynnistetään opiskelijan opinnäytetyönä, koska opiskelijan mielestä aihealue on kiinnostava ja olisi hyvä saada aikaan ympäristö, jossa tunkeutumistestausta voi harjoitella turvallisesti. Projektiin liittyviä lähteitä on jo luettu hieman. Projektista saatava hyöty on käytännön ympäristö, jossa voi turvallisesti harjoitella tunkeutumistestausta.

## Projektin tavoite, tehtävä ja tulokset

Työn tehtävänä on selvittää, kuinka Penetration Testing -harjoitusympäristö toteutetaan vapailla ohjelmilla. Tavoitteena on saada aikaan ympäristö, jossa voi turvallisesti harjoitella tunkeutumistestausta. Ympäristö pitää myös olla helposti saatavilla ja hyödynnettävissä. Projektin tuloksena syntyy tunkeutumistestaukseen sopiva virtualisoitu harjoitusympäristö, jonka voi ladata GitHubista. Projektissa opitaan käyttämään GitHubia, pystyttämään tarvittava ympäristö ja tunkeutumaan johonkin kohteeseen jollakin vapaalla työkalulla, kun ympäristöä testataan. Tätä varten projektissa verrataan työhön sopivia työkaluja keskenään.

## Tutkimuskysymykset

Seuraaviin kysymyksiin vastaaminen auttaa projektin tavoitteiden ja tehtävän saavuttamisessa. Kysymykset on jaoteltu pääkysymykseen ja alakysymyksiin.

Tutkimuksen pääkysymys:

- Kuinka vapailla ohjelmilla toteutetaan Penetration Testing -harjoitusympäristö?

Tutkimuksen alakysymykset:

- Millä välineillä Penetration Testing -harjoitusympäristö kannattaa toteuttaa?

- Millä välineillä tunkeutuminen Penetration Testing -harjoitusympäristöön kannattaa toteuttaa?

- Minkälaiseen kohteeseen kannattaa tunkeutua Penetration Testing -harjoitusympäristössä?

## Kohderyhmä ja rajaus

Työn kohderyhmänä ovat Penetration Testing -aloittelijat, jotka hallitsevat Linuxin ja komentorivin käytön. Työ rajataan käsittämään vapaat ohjelmat. Työhön valitaan yksi tunkeutumistyökalu, yksi virtuaaliympäristön mahdollistava kokonaisuus ja yksi kohde, johon tunkeudutaan.

## Menetelmät ja työn rakenne

Työ tehdään GitHubiin. Työssä pystytetään ympäristö ja testataan sen toiminta. Ensin työssä käydään läpi, mitä Penetration Testing on. Tämän jälkeen verrataan ympäristön toteutukseen soveltuvia työkaluja keskenään. Seuraavaksi verrataan, minkälaisilla työkaluilla tunkeutuminen kannattaa toteuttaa. Sitten verrataan, minkälaiseen kohteeseen kannattaa tunkeutua Penetration Testing -harjoitusympäristössä. Kun nämä asiat ovat selvillä, niin ympäristö toteutetaan valitulla välineellä ja testataan valittuun kohteeseen tunkeutumista sitä varten valitulla työkalulla. Lopuksi pohditaan, miten työn tulokset vastaavat työn tavoitteeseen.

## Käsitteet

|Käsite			| Määritelmä													|
|-----------------------|---------------------------------------------------------------------------------------------------------------|
|DoS | Denial of Service. Palvelunestohyökkäys.	Palveluun kohdistuva hyökkäys, joka estää palvelun käyttämisen.                         |
|IDS | Intrusion Detection System. Tunkeutumisen havaitsemisjärjestelmä. Järjestelmä, joka yrittää havaita mahdollisen tunkeutujan.	|
|IPS | Intrusion Prevention System. Tunkeutumisenestojärjestelmä. Järjestelmä, joka yrittää estää mahdollisen tunkeutumisen.		|
|Palomuuri | Laite tai ohjelmisto, joka suojaa verkkoa suodattamalla tietoliikennettä tiettyjen sääntöjen mukaan.                       |
|Penetration Testing | Tunkeutumistestaus. Sallittu murtautuminen tietojärjestelmiin tietoturvan tilan kartoittamiseksi.		|
|Pääsynhallinta | Tapa hallita pääsyä järjestelmään esimerkiksi käyttäjätunnuksilla ja salasanoilla.					|

# Penetration Testing eli tunkeutumistestaus

Tunkeutumistestauksella (eng. Penetration Testing) tarkoitetaan sallittua murtautumista tietojärjestelmiin ja IT-infrastruktuuriin, jotta saataisiin arvioitua tiettyjen puolustusmekanismien tehokkuus ja kartoitettua, onko ohjelmissa haavoittuvuuksia tai konfigurointivirheitä. Testauksen avulla on myös mahdollista selvittää, noudattavatko käyttäjät tietoturvapolitiikkaa vai käyttäytyvätkö he riskialttiisti yrityksen kannalta. Tunkeutumistestaus suoritetaan yleensä manuaalisesti tai automaattisesti potentiaalisesti alttiisiin kohteisiin, kuten palvelimiin, päätelaitteisiin, langattomiin verkkoihin sekä tietoliikenne- ja mobiililaitteisiin. Jos tunkeutuminen onnistuu jonkin haavoittuvuuden kautta, niin testaajat saattavat yrittää peräkkäisiä hyökkäyksiä ja käyttöoikeuksien korottamista päästäkseen syvemmälle järjestelmiin ja saadakseen tarkemman kuvan järjestelmien tilasta. Kaikki löydetyt haavoittuvuudet, joihin hyökkäys onnistui, esitellään yleensä IT- ja verkkojärjestelmien hallinnoijille strategisten päätösten tekoa ja parannuskeinojen priorisointia varten. Tunkeutumistestauksen perustarkoitus on mitata, kuinka käyttökelpoisia väärin konfiguroidut tai käyttäjien vaarantamat järjestelmät ovat hyökkääjille. Lisäksi testauksessa arvioidaan vastaavien tilanteiden aiheuttamat seuraukset resursseille tai toiminnoille. (Core Security 2015.)

## Tunkeutumistestauksen merkitys ja hyödyt

Tunkeutumistestaus on tärkeää, koska tietomurrot ja palvelukatkokset ovat kalliita. Ne voivat taloudellisten kulujen lisäksi heikentää yrityksen mainetta ja vähentää asiakaskuntaa. Lisäksi on mahdotonta turvata kaikki mahdollinen tieto koko ajan. Perinteiset usean kerroksen puolustusmekanismit, kuten pääsynhallinta, salakirjoitus, IPS, IDS ja palomuurit sekä uusien teknologioiden käyttöönotto ovat lisänneet monimutkaisuutta ja täten tehneet jopa entistä vaikeammaksi tunnistaa kaikki yrityksen mahdolliset haavoittuvuudet. Tunkeutumistestaus auttaa identifioimaan ja priorisoimaan erilaisia turvallisuusriskejä arvioimalla yrityksen kykyä suojata hyödykkeitä sisäiseltä ja ulkoiselta väärinkäytöltä. Jotta voitaisiin varmistaa yhdenmukainen IT- ja verkkoturvallisuuden hallinta, pitäisi tunkeutumistestaus suorittaa säännöllisin väliajoin perusteellisesti. Näin voidaan tehokkaammin estää luvaton pääsy kriittisiin järjestelmiin ja niissä oleviin tietoihin. (Core Security 2015.)

Core Securityn (2015) mukaan tunkeutumistestaus pitäisi lisäksi suorittaa aina, kun

- verkkoinfrastruktuuria tai sovelluksia lisätään
- infrastruktuuriin tai sovelluksiin kohdistuu merkittäviä parannuksia/päivityksiä tai muutoksia
- uusia toimistotiloja otetaan käyttöön
- turvallisuuspaikkauksia otetaan käyttöön
- loppukäyttäjäpolitiikkaa muutetaan.

Tunkeutumistestauksen moniin hyötyihin kuuluu älykäs haavoittuvuuksien hallinta, verkon alhaallaolokulujen välttäminen, säännösteltyjen vaatimusten täyttäminen ja sakkojen välttäminen sekä yrityskuvan ja asiakaskunnan säilyttäminen. Älykäs haavoittuvuuksien hallinta tarkoittaa, että tunkeutumistestauksen avulla saadaan tarkkaa tietoa varsinaisista, hyökättävissä olevista haavoittuvuuksista ja näin pystytään identifioimaan kriittisimpien haavoittuvuuksien joukosta vähemmän merkittävät ja väärät hälytykset. Tämä mahdollistaa parannuskeinojen priorisoinnin ja turvallisuusresurssien tehokkaamman allokoinnin oikeaan aikaan oikeisiin paikkoihin. Verkon alhaallaolokulujen välttäminen tarkoittaa, että tunkeutumistestauksella pystytään ennakoivasti tunnistamaan ja osoittamaan riskejä ennen kuin hyökkäyksiä tai murtoja tapahtuu, ja näin vältetään taloudelliset riskit. Säännösteltyjen vaatimusten täyttäminen ja sakkojen välttäminen tarkoittaa, että tunkeutumistestaus auttaa yrityksiä osoittamaan, että ne noudattavat tiettyjä määräyksiä. Tunkeutumistestauksessa syntyvät tarkat raportit auttavat yrityksiä välttämään määräysten noudattamattomuudesta aiheutuvia sakkoja. Yrityskuvan ja asiakaskunnan säilyttäminen tarkoittaa, että tunkeutumistestaus auttaa yritystä säilyttämään sen maineen ja luotettavuuden, koska yksikin tietomurto voi karkottaa yrityksen nykyisiä asiakkaita ja estää uusien asiakassuhteiden syntymistä. (Core Security 2015.)

## Tunkeutumistestauksen standardi

Tunkeutumistestausta varten on olemassa lähes muodollinen standardi, jonka tarkoitus on tarjota yrityksille ja tunkeutumistestauksen tarjoajille yhteinen kieli. Nämä ovat täten kyseisen standardin kohderyhmänä. Standardin on tarkoitus sisältää minimilähtökohdat tunkeutumistestauksen suorittamista varten. Tämä tarkoittaa, että yritysten on tarkoitus pystyä vaatimaan tunkeutumistestaustyöltä tietyt lähtökohdat standardin avulla. Vastaavasti standardin on tarkoitus tarjota tunkeutumistestauksen tekijöille lähtökohdat huomioon otettavista asioista kartoituksesta raportointiin asti. Lisäksi standardin on myös tarkoitus sisältää korkeampia tasoja vaativampia turvallisuustarpeita varten. Nämä tasot on tarkoitus määritellä alakohtaisesti. Standardi tulee määrittelemään teknisen raportoinnin lisäksi myös mallin yritysjohdolle raportointia varten. (The Penetration Testing Execution Standard 2015a.)

Tunkeutumistestauksen standardi määrittelee, mitä osa-alueita tunkeutumistestaukseen kuuluu. The Penetration Testing Execution Standardin (2014a) mukaan nämä ovat

- Pre-engagement Interactions (työtä edeltävät toimenpiteet)
- Intelligence Gathering (tiedon kerääminen)
- Threat Modeling (uhkien mallintaminen)
- Vulnerability Analysis (haavoittuvuuksien analysointi)
- Exploitation (haavoittuvuuksiin hyökkääminen)
- Post Exploitation (hyökkäysten jälkeiset toimenpiteet)
- Reporting (raportointi).

Seuraavaksi käydään näitä osa-alueita läpi yksi kerrallaan. Osa-alueista pyritään antamaan kokonaiskuva.

### Pre-engagement Interactions

Tämä osa-alue sisältää kysymyksiä, joihin kartoituksen kohteena olevan yrityksen on syytä vastata. Näin saadaan määriteltyä tunkeutumistyön laajuus ja syitä, miksi ja mitä testejä yritys haluaa tunkeutumisyhtiön suorittavan. Työn laajuuden määrittelyssä on tarkoin otettava huomioon työn määrä, siihen käytettävä aika ja hinnoittelu. Asiakasyritys ei aina välttämättä tiedä, mitä asioita tarvitsee testata. Testaajan on siis pystyttävä antamaan opastusta, kun määritellään testattavia asioita. Lisäksi testaajan täytyy ymmärtää, että on eri asia testata yhtä kohdetta suurella intensiteetillä useiden aukkojen löytämistä varten ja montaa kohdetta vain, jotta löytyisi yksi tapa päästä järjestelmään sisään. Tunkeutumistestauksen tavoitteena on identifioida yritykselle haitallisia riskejä. Voi olla, että yrityksen tietoturvan taso ei ole riittävällä tasolla, ja tässä tapauksessa yritys hyötyy enemmän haavoittuvuuksien analysoinnista kuin varsinaisesta tunkeutumistestauksesta. Jos testaajalla on kokemusta testin suorittamisesta, niin yleensä testiin käytettävän ajan pystyy arvioimaan. Kaiken varalta tähän aikaan kannattaa lisätä 20 % yllätysten varalle. Jos työ valmistuu ennen 20 %:n lisäaikaa, niin testaajat voivat esimerkiksi syventyä vielä jonkin vaikean haavoittuvuuden selvittämiseen tai näyttää yrityksen tietoturva-asiantuntijoille, kuinka järjestelmiin päästiin sisään. Sen sijaan, jos osoittautuu, että työtehtävät ylittävät sopimuksessa mainitun työn laajuuden, niin ne pitäisi kirjata Statement Of Work -dokumenttiin, joka molempien osapuolien on syytä allekirjoittaa ennen kuin lisätöitä voidaan aloittaa. Jotta rajat olisivat selkeät, niin työlle täytyy asettaa tarkat aloitus- ja lopetusajankohdat. (The Penetration Testing Execution Standard 2014b.)

Kysymykset on jaoteltu useampaan eri kategorioihin, joita ovat verkon tunkeutumistestaus, websovellusten tunkeutumistestaus, langattoman verkon tunkeutumistestaus, fyysinen tunkeutumistestaus ja sosiaalinen manipulointi. Lisäksi liiketoimintayksiköiden johtajille ja järjestelmänvalvojille on määritelty kysymyksiä. Esimerkiksi ennen verkkoon tunkeutumista on määriteltävä IP-osoitealueet ja toimialueet. On syytä varmistaa, että osoitteet todella kuuluvat kyseiselle yritykselle, jotta tunkeutuminen ei vahingossa tapahdu jonkin muun yrityksen verkkoon. Kolmansille osapuolille, kuten internet- ja pilvipalvelujen tarjoajille, on myös syytä ilmoittaa testauksesta, koska testaajien täytyy mahdollisesti noudattaa erityisiä sääntöjä kyseisiin kohteisiin hyökättäessä. Näin on myös eri maiden kohdalla, joten on hyvä ottaa selvää, missä maissa testattavat palvelimet ovat. Kaikki aiheet eivät välttämättä ole sopivia sosiaalista manipulointia varten, joten kysymyksillä saadaan selville sopivat aihealueet. Palvelunestohyökkäykset (DoS) voivat saada aikaan paljon vahinkoa, joten ne kannattaa suorittaa tuotantoympäristön kanssa identtisessä testiympäristössä. Hätätilanteiden varalle on myös kerättävä tarvittavat yhteystiedot. Yksi osa tunkeutumistestausta on testata yrityksen kykyä reagoida tietoturvaloukkauksiin ja jos järjestelmiin päästään sisälle ilman, että kukaan tietoturvahenkilö huomaa sitä, niin on löydetty valtava tietoturva-aukko. Tilanneraportteja pitäisi tehdä säännöllisin väliajoin. Kaikki arkaluontoinen viestintä pitäisi salakirjoittaa. Kaikkein arkaluontoisimpia tietoja välttämättä voi edes välittää kirjallisessa muodossa, eikä esimerkiksi henkilökohtaisia tietoja saa kerätä. (The Penetration Testing Execution Standard 2014b.)

### Intelligence Gathering

Tässä osion avulla kerättyjen tietojen pohjalta voidaan muodostaa hyökkäyssuunnitelma. Tiedon keräämisessä on kolme tasoa. Ensimmäisessä tasossa kerättävät tiedot mahdollista saada melkein kokonaan automatisoitujen työkalujen avulla. Toisessa tasossa kerättävät tiedot vaativat ensimmäisen tason automaattisten työkalujen lisäksi manuaalista analyysiä. Tasolla saadaan hyvä ymmärrys yrityksen liiketoiminnasta esimerkiksi organisaatiokaavion avulla. Kolmannella tasolla tarvitaan kaikkien alempien tasojen tietojen lisäksi paljon manuaalista analyysiä ja saadaan selville hyvin syvä ymmärrys esimerkiksi liiketoiminnalle tärkeistä asiakassuhteista. Tiedon keruun tasojen saavuttamiseksi on siis tarkoitus saada tiedustelun avulla mahdollisimman paljon tietoa, jota voidaan hyödyntää hyökkäyksissä. Tarvittavia tietoja löytyy yleensä myös julkisista lähteistä, joihin yritykset ja työntekijät ovat antaneet tietojaan. Nämä tiedot eivät kuitenkaan välttämättä ole ajan tasalla, ja ne voivat olla puutteellisia tai jopa vääriä. Aiemmassa vaiheessa määritellyt rajoitukset, aika ja tavoitteet määrittävät, kuinka paljon tietoa voidaan kerätä. Tiedon keruu voidaan suorittaa passiivisesti kolmansien osapuolten kautta, semi-passiivisesti ottamalla yhteyttä yrityksen julkisesti saataviin palveluihin ja aktiivisesti, jolloin tarkoituksena on saada selville esimerkiksi yritysverkon rakenne sekä palvelimissa olevat avoimet palvelut, hakemistot ja tiedostot. Vasta aktiivisen tiedonkeruun pitäisi vaikuttaa epäilyttävältä. (The Penetration Testing Execution Standard 2014c.)

### Threat Modeling

Tämä osio määrittelee, että uhkia mallinnettaessa täytyy säilyttää yhtenäinen tapa esittää uhat ja niiden kyky aiheuttaa haittaa sekä miten uhat vaikuttavat testattavaan yritykseen. Myös toistettavuus on tärkeää. Mallissa on neljä elementtiä: liiketoimintahyödykkeet, liiketoimintaprosessit, hyökkääjät ja hyökkääjien kyvyt. Minimissään nämä kaikki pitäisi tunnistaa ja dokumentoida jokaisessa tunkeutumistestauksessa. Näiden lisäksi pitäisi ottaa huomioon "mitä jos" -tilanteet sen varalta, että hyödykkeitä menetettäisiin. Uhkien mallintaminen on kriittistä molemmille osapuolille, koska sen avulla yritys saa priorisoitua hyödykkeensä tärkeysjärjestykseen ja tunkeutumistestaajat pystyvät toimimaan mahdollisimman samankaltaisesti kuin hyökkääjä. Malli pitäisi luoda hyökkääjän näkökannalta, ja mallissa pitäisi hyödyntää tiedonkeruuvaiheessa saatuja tietoja. (The Penetration Testing Execution Standard 2015b.)

### Vulnerability Analysis



### Exploitation



### Post Exploitation



### Reporting



# Välineet ympäristön toteutukseen



## Vagrant



## VirtualBox



# Välineet ympäristöön tunkeutumiseen



## Metasploit Framework



## Burp Suite



# Kohde, johon tunkeudutaan



## Metasploitable 2



## Muut peruspalvelimet



# Penetration Testing -harjoitusympäristön toteutus



## Virtuaaliympäristön pystytys



## Tunkeutumisen testaaminen



# Pohdinta



# Lähteet

Core Security 2015. Penetration Testing Overview. Luettavissa: http://www.coresecurity.com/penetration-testing-overview. Luettu: 5.12.2015.
(Tarkistettu 13.9.2016, että tieto löytyy Internet Archive Wayback Machinesta http://web.archive.org/web/20160104132108/http://www.coresecurity.com/penetration-testing-overview)

The Penetration Testing Execution Standard 2014a. High Level Organization of the Standard. Luettavissa: http://www.pentest-standard.org/index.php/Main_Page. Luettu: 5.12.2015.

The Penetration Testing Execution Standard 2015a. Penetration Testing Execution Standard - the FAQ. Luettavissa: http://www.pentest-standard.org/index.php/FAQ. Luettu 13.9.2016.

The Penetration Testing Execution Standard 2014b. Pre-engagement. Luettavissa: http://www.pentest-standard.org/index.php/Pre-engagement. Luettu: 14.9.2016.

The Penetration Testing Execution Standard 2014c. Intelligence Gathering. Luettavissa: http://www.pentest-standard.org/index.php/Intelligence_Gathering. Luettu: 16.9.2016.

The Penetration Testing Execution Standard 2015b. Threat Modeling. Luettavissa: http://www.pentest-standard.org/index.php/Threat_Modeling. Luettu: 16.9.2016.

# Liitteet




